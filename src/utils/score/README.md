# 合格率計算モジュール

## 概要

このモジュールは、ユーザーの回答データから試験の合格率を計算するためのロジックを提供します。
合格率は、基本スコア（正解率）、必須問題係数（ペナルティ）、難易度ボーナスの3つの要素を組み合わせて算出されます。

このモジュールは他のコードから独立して動作し、設定値も外部から簡単に変更できるよう設計されています。

## 計算ロジック

合格率の計算式は以下の通りです：

```
最終合格率 = 基本スコア × 必須問題係数 + 難易度ボーナス
```

それぞれの要素の計算方法：

1. **基本スコア**：
   ```
   基本スコア = (正解数 / 全問題数) × 100
   ```

2. **必須問題係数**：
   ```
   必須問題係数 = 1.0 - (1 - 必須問題正解率) × ペナルティ係数
   ```
   必須問題を全問正解した場合は1.0になります。
   1問落とすごとに、設定された係数（デフォルト20%）に応じてペナルティがかかります。

3. **難易度ボーナス**：
   ```
   難易度ボーナス = HIGH問題の正解数 × 0.2
   ```
   難しい問題（HIGH）を正解するごとに、設定値に応じた加点があります。

## 仕様詳細

### パラメータ設定

以下のパラメータは `config.ts` で設定可能です：

- `MANDATORY_PENALTY_FACTOR`: 必須問題のペナルティ係数（デフォルト: 0.2 = 20%）
- `DIFFICULTY_BONUS`: 難易度別の加点係数（デフォルト: HIGH = 0.2%/問）
- `MAX_SCORE`: 最大スコア（デフォルト: 100%）
- `CLIP_MAX_SCORE`: 最大値でクリップするか（デフォルト: true）
- `DECIMAL_PLACES`: 小数点以下の表示桁数（デフォルト: 1桁）

### 使用例

基本的な使用方法：

```typescript
import { calculateScore, QuestionDifficulty } from 'src/utils/score';

// 入力データの準備
const input = {
  questions: [
    { id: '1', isMandatory: true, difficulty: QuestionDifficulty.MID },
    { id: '2', isMandatory: false, difficulty: QuestionDifficulty.HIGH },
    // 他の問題...
  ],
  userAnswers: [
    { questionId: '1', isCorrect: true },
    { questionId: '2', isCorrect: false },
    // 他の回答...
  ]
};

// 合格率計算
const result = calculateScore(input);
console.log(`合格率: ${result.finalScore}%`);
```

詳細な使用例は `examples.ts` ファイルを参照してください。

## 今後の拡張性

このモジュールは、将来的に以下のような機能拡張が可能です：

1. 科目別の合格率計算
2. 部分点を持つ問題タイプへの対応
3. 複数回答問題の対応
4. 時系列での合格率変化の分析

## 制限事項

- 現在のバージョンでは、複数選択問題は「完全に正解」か「不正解」の二択のみサポート
- 科目別の合格率計算は現時点では実装していない 